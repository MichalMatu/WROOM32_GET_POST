<!DOCTYPE html>
<html>

<head>
    <title>ESP32 Web Server</title>
</head>

<body>
    <div id="value">Loading...</div>
    <input type="number" id="newValue" min="1000" max="100000">
    <button onclick="updateValue()">Set</button>
    <p>Wi-Fi AP Credentials:</p>
    <div id="APPassword">Loading...</div>
    <div id="APSSID">Loading...</div>
    <div id="APIP">Loading...</div>
    <p>Wi-Fi STA Credentials</p>
    <div id="STASSID">Loading...</div>
    <div id="STAPassword">Loading...</div>
    <div id="STAIP">Loading...</div>
    <!-- create form to change APSSID_SET and APPassword_SET -->
    <form onsubmit="updateAPCredentials(); return false;">
        <label for="APSSID_SET">AP SSID:</label>
        <input type="text" id="APSSID_SET" name="APSSID_SET"><br><br>
        <label for="APPassword_SET">AP Password:</label>
        <input type="text" id="APPassword_SET" name="APPassword_SET"><br><br>
        <input type="submit" value="Submit">
    </form>





    <script>
        function updateValue() {
            var newValue = document.getElementById('newValue').value;
            if (newValue >= 1000 && newValue <= 100000) {
                sendData(newValue);
            } else {
                alert("Please enter a number between 1000 and 100000");
            }
        }

        function sendData(value) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    document.getElementById('value').innerText = xhr.responseText;
                }
            };
            xhr.open('POST', '/update', true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.send('value=' + encodeURIComponent(value));
        }

        // Function to make an XMLHttpRequest to retrieve the initial value
        function loadInitialValue() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    document.getElementById('value').innerText = xhr.responseText;
                }
            };
            xhr.open('GET', '/getValue', true);
            xhr.send();
        }

        // Function to load the AP credentials
        function loadAPCredentials() {
            fetch('/AP_credentials')
                .then(function (response) {
                    return response.text();
                })
                .then(function (data) {
                    var credentials = data.split(' ');

                    document.getElementById('APSSID').innerText = 'SSID: ' + credentials[0];
                    document.getElementById('APPassword').innerText = 'Password: ' + credentials[1];
                    document.getElementById('APIP').innerText = 'IP Address: ' + credentials[2];
                });
        }

        // Function to load the STA credentials
        function loadSTACredentials() {
            fetch('/STA_credentials')
                .then(function (response) {
                    return response.text();
                })
                .then(function (data) {
                    var credentials = data.split(' ');

                    document.getElementById('STASSID').innerText = 'SSID: ' + credentials[0];
                    document.getElementById('STAPassword').innerText = 'Password: ' + credentials[1];
                    document.getElementById('STAIP').innerText = 'IP Address: ' + credentials[2];
                });
        }

        function updateAPCredentials() {
            var newApSsid = document.getElementById('APSSID_SET').value;
            var newApPassword = document.getElementById('APPassword_SET').value;

            // Add SSID and Password Validations
            var alphanumericRegex = /^[a-z0-9]+$/i; // This regex matches any string made up of letters and numbers

            if (newApSsid.length < 1 || !alphanumericRegex.test(newApSsid)) {
                alert('SSID must be at least 1 character long and only contain letters and numbers.');
                return false;
            }

            if (newApPassword.length < 8 || newApPassword.length > 64 || !alphanumericRegex.test(newApPassword)) {
                alert('Password must be between 8 and 64 characters long and only contain letters and numbers.');
                return false;
            }

            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var credentials = xhr.responseText.split(" ");
                    document.getElementById('APSSID_SET').value = credentials[0];
                    document.getElementById('APPassword_SET').value = credentials[1];
                }
            };
            xhr.open('POST', '/AP_CREDENTIALS_SET', true);
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.send('ap_ssid=' + encodeURIComponent(newApSsid) + '&ap_password=' + encodeURIComponent(newApPassword));
        }





        // Load the initial value when the page is loaded
        window.addEventListener('DOMContentLoaded', loadInitialValue);

        // Call the function to load the AP credentials when the page is loaded
        window.addEventListener('load', loadAPCredentials);

        // Call the function to load the STA credentials when the page is loaded
        window.addEventListener('load', loadSTACredentials);



    </script>
</body>

</html>